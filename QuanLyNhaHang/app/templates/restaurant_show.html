{% extends "layout/base.html" %}
{% block title %}{{ r.name }}{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/restaurant_show.css') }}"/>
{% endblock %}

{% block content %}

{% if added_ok %}
  <div id="addedToast" class="toast-container">
    <div class="success-toast">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <polyline points="9,11 12,14 22,4"></polyline>
        <path d="m21,12c0,5-4,9-9,9s-9-4-9-9 4-9 9-9c1.3,0 2.5,0.3 3.6,0.8"></path>
      </svg>
      <span>ƒê√£ th√™m v√†o gi·ªè h√†ng th√†nh c√¥ng!</span>
    </div>
  </div>
{% endif %}

<a href="{{ url_for('restaurant_list') }}" class="back-link">
  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
    <polyline points="15,18 9,12 15,6"></polyline>
  </svg>
  Quay l·∫°i danh s√°ch nh√† h√†ng
</a>

<!-- Hero th√¥ng tin nh√† h√†ng -->
<div class="card rest-hero mb-4">
  <div class="card-body d-flex flex-column flex-md-row align-items-md-center gap-3">
    <div class="rest-cover">
      {% set cover = r.image_url or url_for('static', filename='img/restaurant-placeholder.jpg') %}
      <img src="{{ cover }}" alt="{{ r.name }}" class="rounded object-fit-cover" style="width: 140px; height: 140px;">
    </div>
    <div class="flex-grow-1">
      <h2 class="mb-1">{{ r.name }}</h2>
      <div class="subtle d-flex flex-wrap gap-3">
        {% if r.address %}
          <span class="d-inline-flex align-items-center">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="me-1">
              <path d="M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z"></path>
              <circle cx="12" cy="10" r="3"></circle>
            </svg>
            {{ r.address }}
          </span>
        {% endif %}
        {% if r.phone %}
          <span class="d-inline-flex align-items-center">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="me-1">
              <path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"></path>
            </svg>
            {{ r.phone }}
          </span>
        {% endif %}
      </div>
    </div>
    <div class="text-end">
      {% if r.is_open %}
        <span class="badge bg-success">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="me-1">
            <circle cx="12" cy="12" r="10"></circle>
            <polyline points="12,6 12,12 16,14"></polyline>
          </svg>
          M·ªü c·ª≠a
        </span>
      {% else %}
        <span class="badge bg-danger">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="me-1">
            <circle cx="12" cy="12" r="10"></circle>
            <path d="m15,9-6,6"></path>
            <path d="m9,9 6,6"></path>
          </svg>
          ƒê√≥ng c·ª≠a
        </span>
      {% endif %}
      <div class="mt-2">
        <a href="{{ url_for('show_cart', restaurant_id=r.id) }}" class="btn btn-outline-primary btn-sm">Xem gi·ªè h√†ng</a>
      </div>
    </div>
  </div>
</div>

<!-- Danh s√°ch m√≥n -->
<div class="card menu-section">
  <div class="card-body">
    <h5 class="section-title">Th·ª±c ƒë∆°n</h5>

    {% if items %}
      <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 menu-grid g-3">
        {% for it in items %}
          <div class="col">
            <div class="menu-card h-100">
              {% set item_cover = it.image_url or url_for('static', filename='img/item-placeholder.jpg') %}
              <div class="menu-media">
                <img src="{{ item_cover }}" alt="{{ it.name }}" class="menu-thumb">
                <span class="price-badge">
                  {{ "{:,.0f}".format((it.price or 0)|float) }} ƒë
                </span>
              </div>

              <div class="menu-body">
                <h6 class="menu-title" title="{{ it.name }}">{{ it.name }}</h6>

                <form class="menu-form" method="post" action="{{ url_for('add_to_cart') }}">
                  <input type="hidden" name="restaurant_id" value="{{ r.id }}">
                  <input type="hidden" name="item_id" value="{{ it.id }}">

                  <div class="menu-actions">
                    <div class="qty-stepper" aria-label="Ch·ªçn s·ªë l∆∞·ª£ng">
                      <button type="button" class="step-btn" data-step="down" aria-label="Gi·∫£m">‚àí</button>
                      <input type="number" name="quantity" class="step-input" min="1" value="1" inputmode="numeric" />
                      <button type="button" class="step-btn" data-step="up" aria-label="TƒÉng">+</button>
                    </div>

                    <button type="submit" class="btn btn-primary add-btn">
                      <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="8" cy="21" r="1"></circle>
                        <circle cx="19" cy="21" r="1"></circle>
                        <path d="M2.05 2.05h2l2.66 12.42a2 2 0 0 0 2 1.58h9.78a2 2 0 0 0 1.95-1.57l1.65-7.43H5.12"></path>
                      </svg>
                      Th√™m v√†o gi·ªè
                    </button>
                  </div>
                </form>
              </div>
            </div>
          </div>
        {% endfor %}
      </div>
    {% else %}
      <div class="empty-menu">
        <div class="empty-menu-icon">üçΩÔ∏è</div>
        <p class="mb-0">Nh√† h√†ng ch∆∞a c√≥ m√≥n n√†o kh·∫£ d·ª•ng.</p>
      </div>
    {% endif %}
  </div>
</div>

{% endblock %}

{% block extra_js %}
<script src="{{ url_for('static', filename='js/restaurant_show.js') }}"></script>
<script>
  // Hi·ªán toast "ƒë√£ th√™m v√†o gi·ªè" r·ªìi t·ª± ·∫©n
  (function () {
    const toast = document.getElementById('addedToast');
    if (!toast) return;
    setTimeout(() => toast.classList.add('show'), 50);
    setTimeout(() => toast.classList.remove('show'), 2500);
  })();
</script>
{% endblock %}
